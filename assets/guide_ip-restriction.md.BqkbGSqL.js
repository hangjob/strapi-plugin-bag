import{_ as s,c as i,o as a,ag as e}from"./chunks/framework.4MsdTtZo.js";const k=JSON.parse('{"title":"IP 访问限制","description":"","frontmatter":{},"headers":[],"relativePath":"guide/ip-restriction.md","filePath":"guide/ip-restriction.md"}'),l={name:"guide/ip-restriction.md"};function n(d,t,o,h,r,p){return a(),i("div",null,[...t[0]||(t[0]=[e(`<h1 id="ip-访问限制" tabindex="-1">IP 访问限制 <a class="header-anchor" href="#ip-访问限制" aria-label="Permalink to &quot;IP 访问限制&quot;">​</a></h1><p>本插件提供了基于中间件的 IP 访问限制功能，允许开发者通过配置白名单或黑名单来控制对 API 的访问权限。</p><h2 id="功能特性" tabindex="-1">功能特性 <a class="header-anchor" href="#功能特性" aria-label="Permalink to &quot;功能特性&quot;">​</a></h2><ul><li><strong>黑白名单支持</strong>：同时支持配置允许访问的 IP（白名单）和禁止访问的 IP（黑名单）。</li><li><strong>优先级策略</strong>：黑名单优先级高于白名单。</li><li><strong>全局生效</strong>：默认应用到插件提供的所有 Content API 路由。</li></ul><h2 id="配置说明" tabindex="-1">配置说明 <a class="header-anchor" href="#配置说明" aria-label="Permalink to &quot;配置说明&quot;">​</a></h2><p>配置位于 Strapi 项目的 <code>config/plugins.js</code> 文件中。</p><h3 id="启用与配置" tabindex="-1">启用与配置 <a class="header-anchor" href="#启用与配置" aria-label="Permalink to &quot;启用与配置&quot;">​</a></h3><p>在 <code>config/plugins.js</code> 中添加以下配置：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;strapi-plugin-bag&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    config: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ipRestriction: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 开启 IP 限制功能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        whitelist: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 白名单：仅允许这些 IP 访问</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        blacklist: [],            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 黑名单：禁止这些 IP 访问</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="参数详解" tabindex="-1">参数详解 <a class="header-anchor" href="#参数详解" aria-label="Permalink to &quot;参数详解&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认值</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>enabled</code></td><td style="text-align:left;"><code>boolean</code></td><td style="text-align:left;"><code>false</code></td><td style="text-align:left;">是否开启 IP 限制功能。关闭时所有请求直接放行。</td></tr><tr><td style="text-align:left;"><code>whitelist</code></td><td style="text-align:left;"><code>string[]</code></td><td style="text-align:left;"><code>[]</code></td><td style="text-align:left;">白名单 IP 列表。如果不为空，则<strong>不在</strong>列表中的 IP 将被拒绝。</td></tr><tr><td style="text-align:left;"><code>blacklist</code></td><td style="text-align:left;"><code>string[]</code></td><td style="text-align:left;"><code>[]</code></td><td style="text-align:left;">黑名单 IP 列表。<strong>在</strong>列表中的 IP 将被拒绝。</td></tr></tbody></table><h2 id="逻辑规则" tabindex="-1">逻辑规则 <a class="header-anchor" href="#逻辑规则" aria-label="Permalink to &quot;逻辑规则&quot;">​</a></h2><p>请求处理流程如下：</p><ol><li><strong>开关检查</strong>：如果 <code>enabled</code> 为 <code>false</code>，则不进行 IP 检查，直接允许访问。</li><li><strong>黑名单检查</strong>：如果请求 IP 存在于 <code>blacklist</code> 中，拒绝访问 (返回 403 Forbidden)。</li><li><strong>白名单检查</strong>：如果 <code>whitelist</code> 不为空，且请求 IP <strong>不在</strong> <code>whitelist</code> 中，拒绝访问 (返回 403 Forbidden)。</li><li><strong>默认通过</strong>：如果白名单为空，且 IP 不在黑名单中，则允许访问。</li></ol><div class="tip custom-block"><p class="custom-block-title">注意</p><p>黑名单的优先级高于白名单。即使一个 IP 同时存在于白名单和黑名单中，它也会被拒绝访问。</p></div><h2 id="适用路由" tabindex="-1">适用路由 <a class="header-anchor" href="#适用路由" aria-label="Permalink to &quot;适用路由&quot;">​</a></h2><p>该功能默认应用于 <code>strapi-plugin-bag</code> 提供的所有前端 API (Content API) 路由，包括但不限于：</p><ul><li>登录 (<code>/auth/login</code>)</li><li>注册 (<code>/auth/register</code>)</li><li>刷新 Token (<code>/auth/refresh-token</code>)</li><li>获取验证码 (<code>/auth/captcha-image</code>, <code>/auth/send-code</code>)</li><li>加密工具 API (<code>/utils/rsa/*</code>, <code>/utils/aes/*</code>)</li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>该限制目前仅针对本插件提供的路由生效，不会影响 Strapi 原生路由或其他插件的路由。</p></div>`,19)])])}const g=s(l,[["render",n]]);export{k as __pageData,g as default};
